tui.util.defineNamespace("fedoc.content", {});
fedoc.content["extensions_mark_wysiwygMarkerHelper.js.html"] = "      <div id=\"main\" class=\"main\">\n\n\n\n    \n    <section>\n        <article>\n            <pre class=\"prettyprint source linenums\"><code>/**\n * @fileoverview Implements wysiwyg marker helper for additional information\n * @author Sungho Kim(sungho-kim@nhnent.com) FE Development Team/NHN Ent.\n */\n\n'use strict';\n\nvar domUtils = require('../../domUtils');\n\nvar FIND_ZWB_RX = /\\u200B/g;\n\n/**\n * WysiwygMarkerHelper\n * @exports WysiwygMarkerHelper\n * @constructor\n * @class\n * @param {SquireExt} sqe squire instance\n */\nfunction WysiwygMarkerHelper(sqe) {\n    this.sqe = sqe;\n}\n\n/**\n * getTextContent\n * Get text content of wysiwyg\n * @returns {string}\n */\nWysiwygMarkerHelper.prototype.getTextContent = function() {\n    return this.sqe.get$Body()[0].textContent.replace(FIND_ZWB_RX, '');\n};\n\n/**\n * updateMarkerWithExtraInfo\n * Update marker with extra info of CodeMirror\n * @param {object} marker marker\n * @returns {object} marker\n */\nWysiwygMarkerHelper.prototype.updateMarkerWithExtraInfo = function(marker) {\n    var foundNode, markerRange, info;\n\n    foundNode = this._findOffsetNode([marker.start, marker.end]);\n\n    markerRange = this.sqe.getSelection().cloneRange();\n    markerRange.setStart(foundNode[0].container, foundNode[0].offsetInContainer);\n    markerRange.setEnd(foundNode[1].container, foundNode[1].offsetInContainer);\n\n    info = this._getExtraInfoOfRange(markerRange);\n\n    marker.text = info.text;\n    marker.top = info.top;\n    marker.left = info.left;\n    marker.height = info.height;\n\n    return marker;\n};\n\n/**\n * _getExtraInfoOfRange\n * Get extra info of range\n * @param {Range} range range\n * @returns {object} extra info\n */\nWysiwygMarkerHelper.prototype._getExtraInfoOfRange = function(range) {\n    var text, top, left, rect, height, node, parentNode, containerOffset;\n    var endContainer = range.endContainer;\n    var endOffset = range.endOffset;\n\n    text = range.cloneContents().textContent.replace(FIND_ZWB_RX, '');\n\n    if (domUtils.getChildNodeByOffset(endContainer, endOffset)) {\n        range.setStart(endContainer, endOffset);\n        range.collapse(true);\n\n        rect = range.getBoundingClientRect();\n    }\n\n    if (rect &amp;&amp; !rect.top) {\n        this.sqe.modifyDocument(function() {\n            node = document.createElement('SPAN');\n            node.textContent = '\\u200B';\n            range.endContainer.parentNode.insertBefore(node, range.endContainer);\n            rect = node.getBoundingClientRect();\n            parentNode = node.parentNode;\n            parentNode.removeChild(node);\n        });\n    }\n\n    if (rect) {\n        containerOffset = this.sqe.get$Body().parent().offset();\n        top = this.sqe.scrollTop() + rect.top - containerOffset.top + $('body').scrollTop();\n        left = rect.left - containerOffset.left;\n        height = rect.height;\n    } else {\n        height = top = left = 0;\n    }\n\n    return {\n        text: text,\n        top: top,\n        left: left,\n        height: height\n    };\n};\n\n/**\n * getMarkerInfoOfCurrentSelection\n * Get marker info of current selection\n * @returns {object} marker\n */\nWysiwygMarkerHelper.prototype.getMarkerInfoOfCurrentSelection = function() {\n    var range, beforeRange, start, end, info;\n\n    range = this.sqe.getSelection().cloneRange();\n\n    if (this._extendRangeToTextNodeIfHasNone(range)) {\n        beforeRange = range.cloneRange();\n        beforeRange.setStart(this.sqe.get$Body()[0], 0);\n        beforeRange.setEnd(range.startContainer, range.startOffset);\n\n        info = this._getExtraInfoOfRange(range);\n\n        start = beforeRange.cloneContents().textContent.length;\n        end = start + info.text.length;\n\n        return {\n            start: start,\n            end: end,\n            text: info.text,\n            top: info.top,\n            left: info.left,\n            height: info.height\n        };\n    }\n\n    return null;\n};\n\n/**\n * _extendRangeToTextNodeIfHasNone\n * Extend range to text node if start or end container have none\n * Containers of range should be text node\n * @param {Range} range range\n * @returns {boolean} success or fail\n */\nWysiwygMarkerHelper.prototype._extendRangeToTextNodeIfHasNone = function(range) {\n    var endNode = domUtils.getChildNodeByOffset(range.endContainer, range.endOffset),\n        textNode;\n\n    if (!domUtils.isTextNode(range.endContainer) || !endNode.nodeValue.replace(FIND_ZWB_RX, '').length) {\n        if (domUtils.isTextNode(endNode)) {\n            range.setEnd(endNode, 0);\n        } else {\n            textNode = domUtils.getPrevTextNode(endNode);\n            if (textNode) {\n                range.setEnd(textNode, textNode.length);\n            } else {\n                return false;\n            }\n        }\n    }\n\n    return true;\n};\n\n/**\n * _findOffsetNode\n * Find offset nodes by given offset list\n * @param {Array.&lt;number>} offsetlist offset list\n * @returns {Array.&lt;object>} offset node informations\n */\nWysiwygMarkerHelper.prototype._findOffsetNode = function(offsetlist) {\n    return domUtils.findOffsetNode(this.sqe.get$Body()[0], offsetlist, function(text) {\n        return text.replace(FIND_ZWB_RX, '');\n    });\n};\n\n/**\n * selectOffsetRange\n * Make selection with given offset range\n * @param {number} start start offset\n * @param {number} end end offset\n */\nWysiwygMarkerHelper.prototype.selectOffsetRange = function(start, end) {\n    var foundNode = this._findOffsetNode([start, end]),\n        range = this.sqe.getSelection().cloneRange();\n\n    range.setStart(foundNode[0].container, foundNode[0].offsetInContainer);\n    range.setEnd(foundNode[1].container, foundNode[1].offsetInContainer);\n\n    this.sqe.setSelection(range);\n};\n\n/**\n * clearSelect\n * Clear selection of squire\n */\nWysiwygMarkerHelper.prototype.clearSelect = function() {\n    var range = this.sqe.getSelection().cloneRange();\n    range.collapse(true);\n    this.sqe.setSelection(range);\n};\n\nmodule.exports = WysiwygMarkerHelper;\n</code></pre>\n        </article>\n    </section>\n\n\n\n</div>\n\n"